(module http
  (fn fetch_json url string -> json
    (set response string (call http_get url))
    (set body string (call http_get_body response))
    (ret (call json_parse body)))
  
  (fn post_json url string data json -> json
    (set json_str string (call json_stringify data))
    (set response string (call http_post url json_str))
    (set body string (call http_get_body response))
    (ret (call json_parse body)))
  
  (fn check_ok response string -> bool
    (set status int (call http_get_status response))
    (set is_200s bool (call ge status 200))
    (set result bool false)
    (if is_200s
      (set result bool (call lt status 300)))
    (ret result))
  
  (fn get_status_text status int -> string
    (set result string "Unknown Status")
    (set is_200 bool (call eq status 200))
    (if is_200
      (set result string "200 OK"))
    (set is_404 bool (call eq status 404))
    (if is_404
      (set result string "404 Not Found"))
    (set is_500 bool (call eq status 500))
    (if is_500
      (set result string "500 Internal Server Error"))
    (ret result))
  
  (fn fetch_text url string -> string
    (set response string (call http_get url))
    (ret (call http_get_body response)))
  
  (fn post_text url string body string -> string
    (set response string (call http_post url body))
    (ret (call http_get_body response)))
  
  (fn get_status url string -> int
    (set response string (call http_get url))
    (ret (call http_get_status response))))