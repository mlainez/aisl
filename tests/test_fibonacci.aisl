(module fibonacci
  (fn fib_nth n int -> int
    (if (call eq n 0)
      (ret 0))
    (if (call eq n 1)
      (ret 1))
    (set n_minus_1 int (call sub n 1))
    (set n_minus_2 int (call sub n 2))
    (set fib1 int (call fib_nth n_minus_1))
    (set fib2 int (call fib_nth n_minus_2))
    (ret (call add fib1 fib2)))
  
  (test-spec fib_nth
    (case "fibonacci 0"
      (input 0)
      (expect 0))
    (case "fibonacci 1"
      (input 1)
      (expect 1))
    (case "fibonacci 2"
      (input 2)
      (expect 1))
    (case "fibonacci 3"
      (input 3)
      (expect 2))
    (case "fibonacci 4"
      (input 4)
      (expect 3))
    (case "fibonacci 5"
      (input 5)
      (expect 5))
    (case "fibonacci 6"
      (input 6)
      (expect 8)))
  
  (meta-note "Tests recursive fibonacci sequence calculation using if statements"))
